name: NovaBridge Android Cloud Build v16.1

on:
  repository_dispatch:
    types: [novabridge_android_build_v16_1]

jobs:
  build-android:
    runs-on: ubuntu-latest

    env:
      BUILD_ID: ${{ github.event.client_payload.build_id }}
      CALLBACK_URL: ${{ github.event.client_payload.callback_url }}
      PROJECT_URL: ${{ github.event.client_payload.project_url }}
      APP_NAME: ${{ github.event.client_payload.app_name }}
      PACKAGE_NAME: ${{ github.event.client_payload.package_name }}

    steps:

      - name: Show payload
        run: |
          echo "BUILD_ID=$BUILD_ID"
          echo "CALLBACK_URL=$CALLBACK_URL"
          echo "PROJECT_URL=$PROJECT_URL"

      - name: Install Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Fake Android Build (replace later)
        run: echo "SUCCESS"

      - name: Notify Worker (SUCCESS)
        if: success()
        run: |
          curl -X POST "$CALLBACK_URL" \
            -H "Content-Type: application/json" \
            -d "{\"build_id\":\"$BUILD_ID\",\"status\":\"success\",\"step\":\"complete\",\"percent\":100}"

      - name: Notify Worker (FAILURE)
        if: failure()
        run: |
          curl -X POST "$CALLBACK_URL" \
            -H "Content-Type: application/json" \
            -d "{\"build_id\":\"$BUILD_ID\",\"status\":\"error\",\"step\":\"error\",\"percent\":50}"
