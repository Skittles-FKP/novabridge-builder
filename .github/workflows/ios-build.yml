      - name: Install XcodeGen
        run: |
          set -e
          if ! command -v xcodegen >/dev/null 2>&1; then
            brew install xcodegen
          fi
          xcodegen --version

      - name: Generate Xcode project
        run: |
          set -e
          cd ios/NovaBridgeDemo-iOS

          if [ ! -f project.yml ]; then
            echo "‚ùå project.yml not found"
            ls -la
            exit 1
          fi

          echo "üì¶ Generating Xcode project..."
          xcodegen generate --spec project.yml

          echo "üìÅ Directory contents after generation:"
          ls -la

          PROJECT=$(ls *.xcodeproj 2>/dev/null || true)
          if [ -z "$PROJECT" ]; then
            echo "‚ùå Xcode project was not generated"
            exit 1
          fi

          echo "‚úÖ Generated project: $PROJECT"

      - name: Build with Xcode
        run: |
          set -e
          cd ios/NovaBridgeDemo-iOS

          PROJECT=$(ls *.xcodeproj | head -n 1)
          echo "üì¶ Using project: $PROJECT"

          echo "üîç Listing schemes..."
          xcodebuild -list -project "$PROJECT"

          SCHEME=$(xcodebuild -list -project "$PROJECT" \
            | sed -n '/Schemes:/,$p' | tail -n +2 | head -n 1 | xargs)

          if [ -z "$SCHEME" ]; then
            echo "‚ùå No scheme found"
            exit 1
          fi

          echo "üéØ Building scheme: $SCHEME"

          xcodebuild \
            -project "$PROJECT" \
            -scheme "$SCHEME" \
            -configuration Release \
            -destination generic/platform=iOS \
            CODE_SIGNING_ALLOWED=NO \
            build
